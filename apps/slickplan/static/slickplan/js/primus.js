!function(name,context,definition){context[name]=definition.call(context),"undefined"!=typeof module&&module.exports?module.exports=context[name]:"function"==typeof define&&define.amd&&define(function(){return context[name]})}("Primus",this,function(){var define,Primus=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";module.exports=function(keys,options){function run(key,selfie){if(options[key]){if("string"==typeof options[key]&&(options[key]=options[key].split(split)),"function"==typeof options[key])return options[key].call(selfie);for(var type,what,i=0;i<options[key].length;i++)what=options[key][i],type=typeof what,"function"===type?what.call(selfie):"string"===type&&"function"==typeof selfie[what]&&selfie[what]()}}var split=/[, ]+/;return options=options||{},keys=keys||[],"string"==typeof keys&&(keys=keys.split(split)),function(){var prop,selfie=this,i=0;if(null===selfie[keys[0]])return!1;for(run("before",selfie);i<keys.length;i++)prop=keys[i],selfie[prop]&&("function"==typeof selfie[prop].destroy&&selfie[prop].destroy(),selfie[prop]=null);return selfie.emit&&selfie.emit("destroy"),run("after",selfie),!0}}},{}],2:[function(_dereq_,module,exports){"use strict";module.exports=function(){for(var parser,self=this,i=0,l=arguments.length,args=new Array(l);l>i;i++)args[i]=arguments[i];return"function"!=typeof args[args.length-1]?function(){for(var i=0,l=arguments.length,arg=new Array(l);l>i;i++)arg[i]=arguments[i];return self.emit.apply(self,args.concat(arg))}:(parser=args.pop(),function(){for(var i=0,l=arguments.length,arg=new Array(l+1);l>i;i++)arg[i+1]=arguments[i];return arg[0]=function(err,returned){return err?self.emit("error",err):(arg=void 0===returned?arg.slice(1):null===returned?[]:returned,void self.emit.apply(self,args.concat(arg)))},parser.apply(self,arg),!0})}},{}],3:[function(_dereq_,module,exports){"use strict";function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){}var prefix="function"!=typeof Object.create?"~":!1;EventEmitter.prototype._events=void 0,EventEmitter.prototype.listeners=function(event,exists){var evt=prefix?prefix+event:event,available=this._events&&this._events[evt];if(exists)return!!available;if(!available)return[];if(this._events[evt].fn)return[this._events[evt].fn];for(var i=0,l=this._events[evt].length,ee=new Array(l);l>i;i++)ee[i]=this._events[evt][i].fn;return ee},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if("function"==typeof listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);len>i;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;length>i;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;default:if(!args)for(j=1,args=new Array(len-1);len>j;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.once=function(event,fn,context){var listener=new EE(fn,context||this,!0),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return this;var listeners=this._events[evt],events=[];if(fn)if(listeners.fn)(listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context)&&events.push(listeners);else for(var i=0,length=listeners.length;length>i;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);return events.length?this._events[evt]=1===events.length?events[0]:events:delete this._events[evt],this},EventEmitter.prototype.removeAllListeners=function(event){return this._events?(event?delete this._events[prefix?prefix+event:event]:this._events=prefix?{}:Object.create(null),this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=prefix,module.exports=EventEmitter},{}],4:[function(_dereq_,module,exports){"use strict";function querystring(query){for(var part,parser=/([^=?&]+)=([^&]*)/g,result={};part=parser.exec(query);result[decodeURIComponent(part[1])]=decodeURIComponent(part[2]));return result}function querystringify(obj,prefix){prefix=prefix||"";var pairs=[];"string"!=typeof prefix&&(prefix="?");for(var key in obj)has.call(obj,key)&&pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]));return pairs.length?prefix+pairs.join("&"):""}var has=Object.prototype.hasOwnProperty;exports.stringify=querystringify,exports.parse=querystring},{}],5:[function(_dereq_,module,exports){"use strict";function defaults(name,selfie,opts){return millisecond(name in opts?opts[name]:name in selfie?selfie[name]:Recovery[name])}function Recovery(options){var recovery=this;return recovery instanceof Recovery?(options=options||{},recovery.attempt=null,recovery._fn=null,recovery["reconnect timeout"]=defaults("reconnect timeout",recovery,options),recovery.retries=defaults("retries",recovery,options),recovery.factor=defaults("factor",recovery,options),recovery.max=defaults("max",recovery,options),recovery.min=defaults("min",recovery,options),void(recovery.timers=new Tick(recovery))):new Recovery(options)}var EventEmitter=_dereq_("eventemitter3"),millisecond=_dereq_("millisecond"),destroy=_dereq_("demolish"),Tick=_dereq_("tick-tock"),one=_dereq_("one-time");Recovery.prototype=new EventEmitter,Recovery.prototype.constructor=Recovery,Recovery["reconnect timeout"]="30 seconds",Recovery.max=1/0,Recovery.min="500 ms",Recovery.retries=10,Recovery.factor=2,Recovery.prototype.reconnect=function(){var recovery=this;return recovery.backoff(function(err,opts){return opts.duration=+new Date-opts.start,err?recovery.emit("reconnect failed",err,opts):void recovery.emit("reconnected",opts)},recovery.attempt)},Recovery.prototype.backoff=function(fn,opts){var recovery=this;return opts=opts||recovery.attempt||{},opts.backoff?recovery:(opts["reconnect timeout"]=defaults("reconnect timeout",recovery,opts),opts.retries=defaults("retries",recovery,opts),opts.factor=defaults("factor",recovery,opts),opts.max=defaults("max",recovery,opts),opts.min=defaults("min",recovery,opts),opts.start=+opts.start||+new Date,opts.duration=+opts.duration||0,opts.attempt=+opts.attempt||0,opts.attempt===opts.retries?(fn.call(recovery,new Error("Unable to recover"),opts),recovery):(opts.backoff=!0,opts.attempt++,recovery.attempt=opts,opts.scheduled=1!==opts.attempt?Math.min(Math.round((Math.random()+1)*opts.min*Math.pow(opts.factor,opts.attempt-1)),opts.max):opts.min,recovery.timers.setTimeout("reconnect",function(){opts.duration=+new Date-opts.start,opts.backoff=!1,recovery.timers.clear("reconnect, timeout");var connect=recovery._fn=one(function(err){return recovery.reset(),err?recovery.backoff(fn,opts):void fn.call(recovery,void 0,opts)});recovery.emit("reconnect",opts,connect),recovery.timers.setTimeout("timeout",function(){var err=new Error("Failed to reconnect in a timely manner");opts.duration=+new Date-opts.start,recovery.emit("reconnect timeout",err,opts),connect(err)},opts["reconnect timeout"])},opts.scheduled),recovery.emit("reconnect scheduled",opts),recovery))},Recovery.prototype.reconnecting=function(){return!!this.attempt},Recovery.prototype.reconnected=function(err){return this._fn&&this._fn(err),this},Recovery.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},Recovery.prototype.destroy=destroy("timers attempt _fn"),module.exports=Recovery},{demolish:1,eventemitter3:3,millisecond:6,"one-time":7,"tick-tock":8}],6:[function(_dereq_,module,exports){module.exports=function(ms){"use strict";if("string"!=typeof ms||"0"===ms||+ms)return+ms;var amount,match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(ms),second=1e3,minute=60*second,hour=60*minute,day=24*hour;if(!match)return 0;switch(amount=parseFloat(match[1]),match[2].toLowerCase()){case"days":case"day":case"d":return amount*day;case"hours":case"hour":case"hrs":case"hr":case"h":return amount*hour;case"minutes":case"minute":case"mins":case"min":case"m":return amount*minute;case"seconds":case"second":case"secs":case"sec":case"s":return amount*second;default:return amount}}},{}],7:[function(_dereq_,module,exports){"use strict";module.exports=function(fn){function onetime(){return called?value:(called=1,value=fn.apply(this,arguments),fn=null,value)}var value,called=0;return onetime.displayName=fn.displayName||fn.name||onetime.displayName||onetime.name,onetime}},{}],8:[function(_dereq_,module,exports){"use strict";function Timer(timer,clear,fn){this.clear=clear,this.timer=timer,this.fns=[fn]}function unsetTimeout(id){clearTimeout(id)}function unsetInterval(id){clearInterval(id)}function unsetImmediate(id){clearImmediate(id)}function Tick(context){return this instanceof Tick?(this.timers={},void(this.context=context||this)):new Tick(context)}var has=Object.prototype.hasOwnProperty,ms=_dereq_("millisecond");Tick.prototype.tock=function(name,clear){var tock=this;return function(){if(name in tock.timers){var timer=tock.timers[name],fns=timer.fns.slice(),l=fns.length,i=0;for(clear&&tock.clear(name);l>i;i++)fns[i].call(tock.context)}}},Tick.prototype.setTimeout=function(name,fn,time){var tick=this;return tick.timers[name]?(tick.timers[name].fns.push(fn),tick):(tick.timers[name]=new Timer(setTimeout(tick.tock(name,!0),ms(time)),unsetTimeout,fn),tick)},Tick.prototype.setInterval=function(name,fn,time){var tick=this;return tick.timers[name]?(tick.timers[name].fns.push(fn),tick):(tick.timers[name]=new Timer(setInterval(tick.tock(name),ms(time)),unsetInterval,fn),tick)},Tick.prototype.setImmediate=function(name,fn){var tick=this;return"function"!=typeof setImmediate?tick.setTimeout(name,fn,0):tick.timers[name]?(tick.timers[name].fns.push(fn),tick):(tick.timers[name]=new Timer(setImmediate(tick.tock(name,!0)),unsetImmediate,fn),tick)},Tick.prototype.active=function(name){return name in this.timers},Tick.prototype.clear=function(){var timer,i,l,args=arguments.length?arguments:[],tick=this;if(1===args.length&&"string"==typeof args[0]&&(args=args[0].split(/[, ]+/)),!args.length)for(timer in tick.timers)has.call(tick.timers,timer)&&args.push(timer);for(i=0,l=args.length;l>i;i++)timer=tick.timers[args[i]],timer&&(timer.clear(timer.timer),timer.fns=timer.timer=timer.clear=null,delete tick.timers[args[i]]);return tick},Tick.prototype.end=Tick.prototype.destroy=function(){return this.context?(this.clear(),this.context=this.timers=null,!0):!1},Tick.prototype.adjust=function(name,time){var interval,tick=this,timer=tick.timers[name];return timer?(interval=timer.clear===unsetInterval,timer.clear(timer.timer),timer.timer=(interval?setInterval:setTimeout)(tick.tock(name,!interval),ms(time)),tick):tick},module.exports=Tick},{millisecond:9}],9:[function(_dereq_,module,exports){arguments[4][6][0].apply(exports,arguments)},{dup:6}],10:[function(_dereq_,module,exports){"use strict";function URL(address,location,parser){if(!(this instanceof URL))return new URL(address,location,parser);var parse,instruction,index,key,relative=relativere.test(address),type=typeof location,url=this,i=0;for("object"!==type&&"string"!==type&&(parser=location,location=null),parser&&"function"!=typeof parser&&(parser=qs.parse),location=lolcation(location);i<instructions.length;i++)instruction=instructions[i],parse=instruction[0],key=instruction[1],parse!==parse?url[key]=address:"string"==typeof parse?~(index=address.indexOf(parse))&&("number"==typeof instruction[2]?(url[key]=address.slice(0,index),address=address.slice(index+instruction[2])):(url[key]=address.slice(index),address=address.slice(0,index))):(index=parse.exec(address))&&(url[key]=index[1],address=address.slice(0,address.length-index[0].length)),url[key]=url[key]||(instruction[3]||"port"===key&&relative?location[key]||"":""),instruction[4]&&(url[key]=url[key].toLowerCase());parser&&(url.query=parser(url.query)),required(url.port,url.protocol)||(url.host=url.hostname,url.port=""),url.username=url.password="",url.auth&&(instruction=url.auth.split(":"),url.username=instruction[0]||"",url.password=instruction[1]||""),url.href=url.toString()}var required=_dereq_("requires-port"),lolcation=_dereq_("./lolcation"),qs=_dereq_("querystringify"),relativere=/^\/(?!\/)/,instructions=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];URL.prototype.set=function(part,value,fn){var url=this;return"query"===part?("string"==typeof value&&(value=(fn||qs.parse)(value)),url[part]=value):"port"===part?(url[part]=value,required(value,url.protocol)?value&&(url.host=url.hostname+":"+value):(url.host=url.hostname,url[part]="")):"hostname"===part?(url[part]=value,url.port&&(value+=":"+url.port),url.host=value):"host"===part?(url[part]=value,/\:\d+/.test(value)&&(value=value.split(":"),url.hostname=value[0],url.port=value[1])):url[part]=value,url.href=url.toString(),url},URL.prototype.toString=function(stringify){stringify&&"function"==typeof stringify||(stringify=qs.stringify);var query,url=this,result=url.protocol+"//";return url.username&&(result+=url.username,url.password&&(result+=":"+url.password),result+="@"),result+=url.hostname,url.port&&(result+=":"+url.port),result+=url.pathname,url.query&&(query="object"==typeof url.query?stringify(url.query):url.query,result+=("?"===query.charAt(0)?"":"?")+query),url.hash&&(result+=url.hash),result},URL.qs=qs,URL.location=lolcation,module.exports=URL},{"./lolcation":11,querystringify:4,"requires-port":12}],11:[function(_dereq_,module,exports){(function(global){"use strict";var URL,ignore={hash:1,query:1};module.exports=function(loc){loc=loc||global.location||{},URL=URL||_dereq_("./");var key,finaldestination={},type=typeof loc;if("blob:"===loc.protocol)finaldestination=new URL(unescape(loc.pathname),{});else if("string"===type){finaldestination=new URL(loc,{});for(key in ignore)delete finaldestination[key]}else if("object"===type)for(key in loc)key in ignore||(finaldestination[key]=loc[key]);return finaldestination}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":10}],12:[function(_dereq_,module,exports){"use strict";module.exports=function(port,protocol){if(protocol=protocol.split(":")[0],port=+port,!port)return!1;switch(protocol){case"http":case"ws":return 80!==port;case"https":case"wss":return 443!==port;case"ftp":return 22!==port;case"gopher":return 70!==port;case"file":return!1}return 0!==port}},{}],13:[function(_dereq_,module,exports){"use strict";function context(self,method){if(!(self instanceof Primus)){var failure=new Error("Primus#"+method+"'s context should called with a Primus instance");if("function"!=typeof self.listeners||!self.listeners("error").length)throw failure;self.emit("error",failure)}}function Primus(url,options){if(!(this instanceof Primus))return new Primus(url,options);if("function"!=typeof this.client){var message="The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details";return this.critical(new Error(message))}"object"==typeof url?(options=url,url=options.url||options.uri||defaultUrl):options=options||{};var primus=this;options.queueSize="queueSize"in options?options.queueSize:1/0,options.timeout="timeout"in options?options.timeout:1e4,options.reconnect="reconnect"in options?options.reconnect:{},options.ping="ping"in options?options.ping:25e3,options.pong="pong"in options?options.pong:1e4,options.strategy="strategy"in options?options.strategy:[],options.transport="transport"in options?options.transport:{},primus.buffer=[],primus.writable=!0,primus.readable=!0,primus.url=primus.parse(url||defaultUrl),primus.readyState=Primus.CLOSED,primus.options=options,primus.timers=new TickTock(this),primus.socket=null,primus.latency=0,primus.stamps=0,primus.disconnect=!1,primus.transport=options.transport,primus.transformers={outgoing:[],incoming:[]},primus.recovery=new Recovery(options.reconnect),"string"==typeof options.strategy&&(options.strategy=options.strategy.split(/\s?\,\s?/g)),!1===options.strategy?options.strategy=[]:options.strategy.length||(options.strategy.push("disconnect","online"),this.authorization||options.strategy.push("timeout")),options.strategy=options.strategy.join(",").toLowerCase(),"websockets"in options&&(primus.AVOID_WEBSOCKETS=!options.websockets),"network"in options&&(primus.NETWORK_EVENTS=options.network),options.manual||primus.timers.setTimeout("open",function(){primus.timers.clear("open"),primus.open()},0),primus.initialise(options)}var defaultUrl,EventEmitter=_dereq_("eventemitter3"),TickTock=_dereq_("tick-tock"),Recovery=_dereq_("recovery"),qs=_dereq_("querystringify"),destroy=_dereq_("demolish"),u2028=/\u2028/g,u2029=/\u2029/g;try{defaultUrl=location.origin?location.origin:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}catch(e){defaultUrl="http://127.0.0.1"}Primus.require=function(name){return"function"!=typeof _dereq_?void 0:"function"==typeof define&&define.amd?void 0:_dereq_(name)};var Stream;try{Primus.Stream=Stream=Primus.require("stream"),Primus.require("util").inherits(Primus,Stream)}catch(e){Primus.Stream=EventEmitter,Primus.prototype=new EventEmitter}Primus.OPENING=1,Primus.CLOSED=2,Primus.OPEN=3,Primus.prototype.AVOID_WEBSOCKETS=!1,Primus.prototype.NETWORK_EVENTS=!1,Primus.prototype.online=!0;try{(Primus.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(Primus.prototype.online=!1))}catch(e){}if(Primus.prototype.ark={},Primus.prototype.emits=_dereq_("emits"),Primus.prototype.trigger=function(){for(var i=0,l=arguments.length,args=new Array(l);l>i;i++)args[i]=arguments[i];return"function"!=typeof args[l-1]&&args.push(function(next){setTimeout(next,0)}),this.emits.apply(this,args)},Primus.prototype.plugin=function(name){if(context(this,"plugin"),name)return this.ark[name];var plugins={};for(name in this.ark)plugins[name]=this.ark[name];return plugins},Primus.prototype.reserved=function(evt){return/^(incoming|outgoing)::/.test(evt)||evt in this.reserved.events},Primus.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,online:1,error:1,close:1,open:1,data:1,end:1},Primus.prototype.initialise=function(options){function offline(){primus.online&&(primus.online=!1,primus.emit("offline"),primus.end(),primus.recovery.reset())}function online(){primus.online||(primus.online=!0,primus.emit("online"),~primus.options.strategy.indexOf("online")&&primus.recovery.reconnect())}var start,primus=this;primus.recovery.on("reconnected",primus.emits("reconnected")).on("reconnect failed",primus.emits("reconnect failed",function(data){return primus.emit("end"),data})).on("reconnect timeout",primus.emits("reconnect timeout")).on("reconnect scheduled",primus.emits("reconnect scheduled")).on("reconnect",primus.emits("reconnect",function(next){primus.emit("outgoing::reconnect"),next()})),primus.on("outgoing::open",function(){var readyState=primus.readyState;primus.readyState=Primus.OPENING,readyState!==primus.readyState&&primus.emit("readyStateChange","opening"),start=+new Date}),primus.on("incoming::open",function(){var readyState=primus.readyState;if(primus.recovery.reconnecting()&&primus.recovery.reconnected(),primus.writable=!0,primus.readable=!0,primus.online||(primus.online=!0,primus.emit("online")),primus.readyState=Primus.OPEN,readyState!==primus.readyState&&primus.emit("readyStateChange","open"),primus.latency=+new Date-start,primus.timers.clear("ping","pong"),primus.heartbeat(),primus.buffer.length){var data=primus.buffer.slice(),length=data.length,i=0;for(primus.buffer.length=0;length>i;i++)primus._write(data[i])}primus.emit("open")}),primus.on("incoming::pong",function(time){primus.online=!0,primus.timers.clear("pong"),primus.heartbeat(),primus.latency=+new Date-time}),primus.on("incoming::error",function(e){var connect=primus.timers.active("connect"),err=e;if("string"==typeof e)err=new Error(e);else if(!(e instanceof Error)&&"object"==typeof e){err=new Error(e.message||e.reason);for(var key in e)Object.prototype.hasOwnProperty.call(e,key)&&(err[key]=e[key])}return primus.recovery.reconnecting()?primus.recovery.reconnected(err):(primus.listeners("error").length&&primus.emit("error",err),void(connect&&(~primus.options.strategy.indexOf("timeout")?primus.recovery.reconnect():primus.end())))}),primus.on("incoming::data",function(raw){primus.decoder(raw,function(err,data){return err?primus.listeners("error").length&&primus.emit("error",err):void(primus.protocol(data)||primus.transforms(primus,primus,"incoming",data,raw))})}),primus.on("incoming::end",function(){var readyState=primus.readyState;return primus.disconnect?(primus.disconnect=!1,primus.end()):(primus.readyState=Primus.CLOSED,readyState!==primus.readyState&&primus.emit("readyStateChange","end"),primus.timers.active("connect")&&primus.end(),readyState!==Primus.OPEN?primus.recovery.reconnecting()?primus.recovery.reconnect():!1:(this.writable=!1,this.readable=!1,this.timers.clear(),primus.emit("close"),~primus.options.strategy.indexOf("disconnect")?primus.recovery.reconnect():(primus.emit("outgoing::end"),void primus.emit("end"))))}),primus.client();for(var plugin in primus.ark)primus.ark[plugin].call(primus,primus,options);return primus.NETWORK_EVENTS?(window.addEventListener?(window.addEventListener("offline",offline,!1),window.addEventListener("online",online,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",offline),document.body.attachEvent("ononline",online)),primus):primus},Primus.prototype.protocol=function(msg){if("string"!=typeof msg||0!==msg.indexOf("primus::"))return!1;var last=msg.indexOf(":",8),value=msg.slice(last+2);switch(msg.slice(8,last)){case"pong":this.emit("incoming::pong",+value);break;case"server":"close"===value&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",value);break;default:return!1}return!0},Primus.prototype.transforms=function(primus,connection,type,data,raw){var packet={data:data},fns=primus.transformers[type];return function transform(index,done){var transformer=fns[index++];if(!transformer)return done();if(1===transformer.length){if(!1===transformer.call(connection,packet))return;return transform(index,done)}transformer.call(connection,packet,function(err,arg){return err?connection.emit("error",err):void(!1!==arg&&transform(index,done))})}(0,function(){return"incoming"===type?connection.emit("data",packet.data,raw):void connection._write(packet.data)}),this},Primus.prototype.id=function(fn){return this.socket&&this.socket.id?fn(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",fn))},Primus.prototype.open=function(){return context(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},Primus.prototype.write=function(data){return context(this,"write"),this.transforms(this,this,"outgoing",data),!0},Primus.prototype._write=function(data){var primus=this;return Primus.OPEN!==primus.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(data),!1):(primus.encoder(data,function(err,packet){return err?primus.listeners("error").length&&primus.emit("error",err):("string"==typeof packet&&(~packet.indexOf("\u2028")&&(packet=packet.replace(u2028,"\\u2028")),~packet.indexOf("\u2029")&&(packet=packet.replace(u2029,"\\u2029"))),void primus.emit("outgoing::data",packet))}),!0)},Primus.prototype.heartbeat=function(){function pong(){primus.timers.clear("pong"),primus.online&&(primus.online=!1,primus.emit("offline"),primus.emit("incoming::end"))}function ping(){var value=+new Date;primus.timers.clear("ping"),primus._write("primus::ping::"+value),primus.emit("outgoing::ping",value),primus.timers.setTimeout("pong",pong,primus.options.pong)}var primus=this;return primus.options.ping?(primus.timers.setTimeout("ping",ping,primus.options.ping),this):primus},Primus.prototype.timeout=function(){function remove(){primus.removeListener("error",remove).removeListener("open",remove).removeListener("end",remove).timers.clear("connect")}var primus=this;return primus.timers.setTimeout("connect",function(){remove(),primus.readyState===Primus.OPEN||primus.recovery.reconnecting()||(primus.emit("timeout"),~primus.options.strategy.indexOf("timeout")?primus.recovery.reconnect():primus.end())},primus.options.timeout),primus.on("error",remove).on("open",remove).on("end",remove)},Primus.prototype.end=function(data){if(context(this,"end"),this.readyState===Primus.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==data&&this.write(data),this.writable=!1,this.readable=!1;var readyState=this.readyState;return this.readyState=Primus.CLOSED,readyState!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},Primus.prototype.destroy=destroy("url timers options recovery socket transport transformers",{before:"end",after:"removeAllListeners"}),Primus.prototype.clone=function(obj){return this.merge({},obj)},Primus.prototype.merge=function(target){for(var key,obj,args=Array.prototype.slice.call(arguments,1),i=0,l=args.length;l>i;i++){obj=args[i];for(key in obj)obj.hasOwnProperty(key)&&(target[key]=obj[key])}return target},Primus.prototype.parse=_dereq_("url-parse"),Primus.prototype.querystring=qs.parse,Primus.prototype.querystringify=qs.stringify,Primus.prototype.uri=function(options){var url=this.url,server=[],qsa=!1;options.query&&(qsa=!0),options=options||{},options.protocol="protocol"in options?options.protocol:"http:",options.query=url.query&&qsa?url.query.slice(1):!1,options.secure="secure"in options?options.secure:"https:"===url.protocol||"wss:"===url.protocol,options.auth="auth"in options?options.auth:url.auth,options.pathname="pathname"in options?options.pathname:this.pathname,options.port="port"in options?+options.port:+url.port||(options.secure?443:80),this.emit("outgoing::url",options);var querystring=this.querystring(options.query||"");return querystring._primuscb=+new Date+"-"+this.stamps++,options.query=this.querystringify(querystring),server.push(options.secure?options.protocol.replace(":","s:"):options.protocol,""),server.push(options.auth?options.auth+"@"+url.host:url.host),options.pathname&&server.push(options.pathname.slice(1)),qsa?server.push("?"+options.query):delete options.query,options.object?options:server.join("/")},Primus.prototype.transform=function(type,fn){return context(this,"transform"),type in this.transformers?(this.transformers[type].push(fn),this):this.critical(new Error("Invalid transformer type"))},Primus.prototype.critical=function(err){if(this.listeners("error").length)return this.emit("error",err),this;throw err},Primus.connect=function(url,options){return new Primus(url,options)},Primus.EventEmitter=EventEmitter,Primus.prototype.client=function(){var socket,onmessage=this.trigger("incoming::data"),onerror=this.trigger("incoming::error"),onopen=this.trigger("incoming::open"),onclose=this.trigger("incoming::end"),primus=this,factory=function(){if("undefined"!=typeof eio)return eio;try{return Primus.require("engine.io-client")}catch(e){}return void 0}();return factory?(primus.on("outgoing::open",function(){primus.emit("outgoing::end"),primus.socket=socket=factory(primus.merge(primus.transport,primus.url,primus.uri({protocol:"http:",query:!0,object:!0}),{host:null,rememberUpgrade:!1,forceBase64:!0,enablesXDR:!1,timestampRequests:!0,path:this.pathname,transports:primus.AVOID_WEBSOCKETS?["polling"]:["polling","websocket"]})),factory.sockets&&factory.sockets.length&&(factory.sockets.length=0),socket.on("message",onmessage),socket.on("error",onerror),socket.on("close",onclose),socket.on("open",onopen)}),primus.on("outgoing::data",function(message){socket&&socket.send(message)}),primus.on("outgoing::reconnect",function(){primus.emit("outgoing::open")}),void primus.on("outgoing::end",function(){socket&&(socket.removeListener("message",onmessage),socket.removeListener("error",onerror),socket.removeListener("close",onclose),socket.removeListener("open",onopen),socket.close(),socket=null)})):primus.critical(new Error("Missing required `engine.io-client` module. Please run `npm install --save engine.io-client`"))},Primus.prototype.authorization=!1,Primus.prototype.pathname="/primus",Primus.prototype.encoder=function(data,fn){var err;try{data=JSON.stringify(data)}catch(e){err=e}fn(err,data)},Primus.prototype.decoder=function(data,fn){var err;if("string"!=typeof data)return fn(err,data);try{data=JSON.parse(data)}catch(e){err=e}fn(err,data)},Primus.prototype.version="3.1.1","undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",function(e){27===e.keyCode&&e.preventDefault&&e.preventDefault()},!1);var ua=(navigator.userAgent||"").toLowerCase(),parsed=ua.match(/.+(?:rv|it|ra|ie)[\/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],version=+[parsed[1],parsed[2]].join(".");!~ua.indexOf("chrome")&&~ua.indexOf("safari")&&534.54>version&&(Primus.prototype.AVOID_WEBSOCKETS=!0)}module.exports=Primus},{demolish:1,emits:2,eventemitter3:3,querystringify:4,recovery:5,"tick-tock":8,"url-parse":10}]},{},[13])(13);return Primus.prototype.ark.emitter=function(){},Primus}),function(Primus){!function(e){var f;"undefined"!=typeof window?f=window:"undefined"!=typeof self&&(f=self),f.eio=e()}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);
return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":2}],2:[function(_dereq_,module,exports){module.exports=_dereq_("./socket"),module.exports.parser=_dereq_("engine.io-parser")},{"./socket":3,"engine.io-parser":16}],3:[function(_dereq_,module,exports){(function(global){function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);if(opts=opts||{},uri&&"object"==typeof uri&&(opts=uri,uri=null),uri&&(uri=parseuri(uri),opts.host=uri.host,opts.secure="https"==uri.protocol||"wss"==uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)),this.secure=null!=opts.secure?opts.secure:global.location&&"https:"==location.protocol,opts.host){var pieces=opts.host.split(":");opts.hostname=pieces.shift(),pieces.length?opts.port=pieces.pop():opts.port||(opts.port=this.secure?"443":"80")}this.agent=opts.agent||!1,this.hostname=opts.hostname||(global.location?location.hostname:"localhost"),this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=opts.query||{},"string"==typeof this.query&&(this.query=parseqs.decode(this.query)),this.upgrade=!1!==opts.upgrade,this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!opts.forceJSONP,this.jsonp=!1!==opts.jsonp,this.forceBase64=!!opts.forceBase64,this.enablesXDR=!!opts.enablesXDR,this.timestampParam=opts.timestampParam||"t",this.timestampRequests=opts.timestampRequests,this.transports=opts.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=opts.policyPort||843,this.rememberUpgrade=opts.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades,this.pfx=opts.pfx||null,this.key=opts.key||null,this.passphrase=opts.passphrase||null,this.cert=opts.cert||null,this.ca=opts.ca||null,this.ciphers=opts.ciphers||null,this.rejectUnauthorized=opts.rejectUnauthorized||null,this.open()}function clone(obj){var o={};for(var i in obj)obj.hasOwnProperty(i)&&(o[i]=obj[i]);return o}var transports=_dereq_("./transports"),Emitter=_dereq_("component-emitter"),debug=_dereq_("debug")("engine.io-client:socket"),index=_dereq_("indexof"),parser=_dereq_("engine.io-parser"),parseuri=_dereq_("parseuri"),parsejson=_dereq_("parsejson"),parseqs=_dereq_("parseqs");module.exports=Socket,Socket.priorWebsocketSuccess=!1,Emitter(Socket.prototype),Socket.protocol=parser.protocol,Socket.Socket=Socket,Socket.Transport=_dereq_("./transport"),Socket.transports=_dereq_("./transports"),Socket.parser=_dereq_("engine.io-parser"),Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol,query.transport=name,this.id&&(query.sid=this.id);var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return transport},Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))transport="websocket";else{if(0==this.transports.length){var self=this;return void setTimeout(function(){self.emit("error","No transports available")},0)}transport=this.transports[0]}this.readyState="opening";var transport;try{transport=this.createTransport(transport)}catch(e){return this.transports.shift(),void this.open()}transport.open(),this.setTransport(transport)},Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;this.transport&&(debug("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=transport,transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})},Socket.prototype.probe=function(name){function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}failed||(debug('probe transport "%s" opened',name),transport.send([{type:"ping",data:"probe"}]),transport.once("packet",function(msg){if(!failed)if("pong"==msg.type&&"probe"==msg.data){if(debug('probe transport "%s" pong',name),self.upgrading=!0,self.emit("upgrading",transport),!transport)return;Socket.priorWebsocketSuccess="websocket"==transport.name,debug('pausing current transport "%s"',self.transport.name),self.transport.pause(function(){failed||"closed"!=self.readyState&&(debug("changing transport and sending upgrade packet"),cleanup(),self.setTransport(transport),transport.send([{type:"upgrade"}]),self.emit("upgrade",transport),transport=null,self.upgrading=!1,self.flush())})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name,self.emit("upgradeError",err)}}))}function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name,freezeTransport(),debug('probe transport "%s" failed because of error: %s',name,err),self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!=transport.name&&(debug('"%s" works - aborting "%s"',to.name,transport.name),freezeTransport())}function cleanup(){transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),self.removeListener("close",onclose),self.removeListener("upgrading",onupgrade)}debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=!1,self=this;Socket.priorWebsocketSuccess=!1,transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),transport.open()},Socket.prototype.onOpen=function(){if(debug("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;l>i;i++)this.probe(this.upgrades[i])}},Socket.prototype.onPacket=function(packet){if("opening"==this.readyState||"open"==this.readyState)switch(debug('socket receive: type "%s", data "%s"',packet.type,packet.data),this.emit("packet",packet),this.emit("heartbeat"),packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing();break;case"error":var err=new Error("server error");err.code=packet.data,this.emit("error",err);break;case"message":this.emit("data",packet.data),this.emit("message",packet.data)}else debug('packet received with socket readyState "%s"',this.readyState)},Socket.prototype.onHandshake=function(data){this.emit("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){"closed"!=self.readyState&&self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)},Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer),self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout),self.ping(),self.onHeartbeat(self.pingTimeout)},self.pingInterval)},Socket.prototype.ping=function(){this.sendPacket("ping")},Socket.prototype.onDrain=function(){for(var i=0;i<this.prevBufferLen;i++)this.callbackBuffer[i]&&this.callbackBuffer[i]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},Socket.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(debug("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Socket.prototype.write=Socket.prototype.send=function(msg,fn){return this.sendPacket("message",msg,fn),this},Socket.prototype.sendPacket=function(type,data,fn){if("closing"!=this.readyState&&"closed"!=this.readyState){var packet={type:type,data:data};this.emit("packetCreate",packet),this.writeBuffer.push(packet),this.callbackBuffer.push(fn),this.flush()}},Socket.prototype.close=function(){function close(){self.onClose("forced close"),debug("socket closing - telling transport to close"),self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose),self.removeListener("upgradeError",cleanupAndClose),close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose),self.once("upgradeError",cleanupAndClose)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var self=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?waitForUpgrade():close()}):this.upgrading?waitForUpgrade():close()}return this},Socket.prototype.onError=function(err){debug("socket error %j",err),Socket.priorWebsocketSuccess=!1,this.emit("error",err),this.onClose("transport error",err)},Socket.prototype.onClose=function(reason,desc){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){self.writeBuffer=[],self.callbackBuffer=[],self.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",reason,desc)}},Socket.prototype.filterUpgrades=function(upgrades){for(var filteredUpgrades=[],i=0,j=upgrades.length;j>i;i++)~index(this.transports,upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":4,"./transports":5,"component-emitter":11,debug:13,"engine.io-parser":16,indexof:27,parsejson:28,parseqs:29,parseuri:30}],4:[function(_dereq_,module,exports){function Transport(opts){this.path=opts.path,this.hostname=opts.hostname,this.port=opts.port,this.secure=opts.secure,this.query=opts.query,this.timestampParam=opts.timestampParam,this.timestampRequests=opts.timestampRequests,this.readyState="",this.agent=opts.agent||!1,this.socket=opts.socket,this.enablesXDR=opts.enablesXDR,this.pfx=opts.pfx,this.key=opts.key,this.passphrase=opts.passphrase,this.cert=opts.cert,this.ca=opts.ca,this.ciphers=opts.ciphers,this.rejectUnauthorized=opts.rejectUnauthorized}var parser=_dereq_("engine.io-parser"),Emitter=_dereq_("component-emitter");module.exports=Transport,Emitter(Transport.prototype),Transport.timestamps=0,Transport.prototype.onError=function(msg,desc){var err=new Error(msg);return err.type="TransportError",err.description=desc,this.emit("error",err),this},Transport.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},Transport.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},Transport.prototype.send=function(packets){if("open"!=this.readyState)throw new Error("Transport not open");this.write(packets)},Transport.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)},Transport.prototype.onPacket=function(packet){this.emit("packet",packet)},Transport.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":11,"engine.io-parser":16}],5:[function(_dereq_,module,exports){(function(global){function polling(opts){var xhr,xd=!1,xs=!1,jsonp=!1!==opts.jsonp;if(global.location){var isSSL="https:"==location.protocol,port=location.port;port||(port=isSSL?443:80),xd=opts.hostname!=location.hostname||port!=opts.port,xs=opts.secure!=isSSL}if(opts.xdomain=xd,opts.xscheme=xs,xhr=new XMLHttpRequest(opts),"open"in xhr&&!opts.forceJSONP)return new XHR(opts);if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)}var XMLHttpRequest=_dereq_("xmlhttprequest"),XHR=_dereq_("./polling-xhr"),JSONP=_dereq_("./polling-jsonp"),websocket=_dereq_("./websocket");exports.polling=polling,exports.websocket=websocket}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,xmlhttprequest:10}],6:[function(_dereq_,module,exports){(function(global){function empty(){}function JSONPPolling(opts){Polling.call(this,opts),this.query=this.query||{},callbacks||(global.___eio||(global.___eio=[]),callbacks=global.___eio),this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){self.script&&(self.script.onerror=empty)},!1)}var Polling=_dereq_("./polling"),inherit=_dereq_("component-inherit");module.exports=JSONPPolling;var callbacks,rNewline=/\n/g,rEscapedNewline=/\\n/g;inherit(JSONPPolling,Polling),JSONPPolling.prototype.supportsBinary=!1,JSONPPolling.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Polling.prototype.doClose.call(this)},JSONPPolling.prototype.doPoll=function(){var self=this,script=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),script.async=!0,script.src=this.uri(),script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt),this.script=script;var isUAgecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);isUAgecko&&setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe),document.body.removeChild(iframe)},100)},JSONPPolling.prototype.doWrite=function(data,fn){function complete(){initIframe(),fn()}function initIframe(){if(self.iframe)try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe"),iframe.name=self.iframeId,iframe.src="javascript:0"}iframe.id=self.iframeId,self.form.appendChild(iframe),self.iframe=iframe}var self=this;if(!this.form){var iframe,form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="eio_iframe_"+this.index;form.className="socketio",form.style.position="absolute",form.style.top="-1000px",form.style.left="-1000px",form.target=id,form.method="POST",form.setAttribute("accept-charset","utf-8"),area.name="d",form.appendChild(area),document.body.appendChild(form),this.form=form,this.area=area}this.form.action=this.uri(),initIframe(),data=data.replace(rEscapedNewline,"\\\n"),this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==self.iframe.readyState&&complete()}:this.iframe.onload=complete}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":8,"component-inherit":12}],7:[function(_dereq_,module,exports){(function(global){function empty(){}function XHR(opts){if(Polling.call(this,opts),global.location){var isSSL="https:"==location.protocol,port=location.port;port||(port=isSSL?443:80),this.xd=opts.hostname!=global.location.hostname||port!=opts.port,this.xs=opts.secure!=isSSL}}function Request(opts){this.method=opts.method||"GET",this.uri=opts.uri,this.xd=!!opts.xd,this.xs=!!opts.xs,this.async=!1!==opts.async,this.data=void 0!=opts.data?opts.data:null,this.agent=opts.agent,this.isBinary=opts.isBinary,this.supportsBinary=opts.supportsBinary,this.enablesXDR=opts.enablesXDR,this.pfx=opts.pfx,this.key=opts.key,this.passphrase=opts.passphrase,this.cert=opts.cert,this.ca=opts.ca,this.ciphers=opts.ciphers,this.rejectUnauthorized=opts.rejectUnauthorized,this.create()}function unloadHandler(){for(var i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}var XMLHttpRequest=_dereq_("xmlhttprequest"),Polling=_dereq_("./polling"),Emitter=_dereq_("component-emitter"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:polling-xhr");module.exports=XHR,module.exports.Request=Request,inherit(XHR,Polling),XHR.prototype.supportsBinary=!0,XHR.prototype.request=function(opts){return opts=opts||{},opts.uri=this.uri(),opts.xd=this.xd,opts.xs=this.xs,opts.agent=this.agent||!1,opts.supportsBinary=this.supportsBinary,opts.enablesXDR=this.enablesXDR,opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized,new Request(opts)},XHR.prototype.doWrite=function(data,fn){var isBinary="string"!=typeof data&&void 0!==data,req=this.request({method:"POST",data:data,isBinary:isBinary}),self=this;req.on("success",fn),req.on("error",function(err){self.onError("xhr post error",err)}),this.sendXhr=req},XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request(),self=this;req.on("data",function(data){self.onData(data)}),req.on("error",function(err){self.onError("xhr poll error",err)}),this.pollXhr=req},Emitter(Request.prototype),Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts),self=this;try{if(debug("xhr open %s: %s",this.method,this.uri),xhr.open(this.method,this.uri,this.async),this.supportsBinary&&(xhr.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?xhr.setRequestHeader("Content-type","application/octet-stream"):xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in xhr&&(xhr.withCredentials=!0),this.hasXDR()?(xhr.onload=function(){self.onLoad()},xhr.onerror=function(){self.onError(xhr.responseText)}):xhr.onreadystatechange=function(){4==xhr.readyState&&(200==xhr.status||1223==xhr.status?self.onLoad():setTimeout(function(){self.onError(xhr.status)},0))},debug("xhr data %s",this.data),xhr.send(this.data)}catch(e){return void setTimeout(function(){self.onError(e)},0)}global.document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)},Request.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Request.prototype.onData=function(data){this.emit("data",data),this.onSuccess()},Request.prototype.onError=function(err){this.emit("error",err),this.cleanup(!0)},Request.prototype.cleanup=function(fromError){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=empty:this.xhr.onreadystatechange=empty,fromError)try{this.xhr.abort()}catch(e){}global.document&&delete Request.requests[this.index],this.xhr=null}},Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}data="application/octet-stream"===contentType?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(e){this.onError(e)}null!=data&&this.onData(data)},Request.prototype.hasXDR=function(){return"undefined"!=typeof global.XDomainRequest&&!this.xs&&this.enablesXDR},Request.prototype.abort=function(){this.cleanup()},global.document&&(Request.requestsCount=0,Request.requests={},global.attachEvent?global.attachEvent("onunload",unloadHandler):global.addEventListener&&global.addEventListener("beforeunload",unloadHandler,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":8,"component-emitter":11,"component-inherit":12,debug:13,xmlhttprequest:10}],8:[function(_dereq_,module,exports){function Polling(opts){var forceBase64=opts&&opts.forceBase64;(!hasXHR2||forceBase64)&&(this.supportsBinary=!1),Transport.call(this,opts)}var Transport=_dereq_("../transport"),parseqs=_dereq_("parseqs"),parser=_dereq_("engine.io-parser"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_("xmlhttprequest"),xhr=new XMLHttpRequest({xdomain:!1});return null!=xhr.responseType}();inherit(Polling,Transport),Polling.prototype.name="polling",Polling.prototype.doOpen=function(){this.poll()},Polling.prototype.pause=function(onPause){function pause(){debug("paused"),self.readyState="paused",onPause()}var self=this;if(this.readyState="pausing",this.polling||!this.writable){var total=0;this.polling&&(debug("we are currently polling - waiting to pause"),total++,this.once("pollComplete",function(){debug("pre-pause polling complete"),--total||pause()})),this.writable||(debug("we are currently writing - waiting to pause"),total++,this.once("drain",function(){debug("pre-pause writing complete"),--total||pause()}))}else pause()},Polling.prototype.poll=function(){debug("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet,index,total){return"opening"==self.readyState&&self.onOpen(),"close"==packet.type?(self.onClose(),!1):void self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():debug('ignoring poll - transport state "%s"',this.readyState))},Polling.prototype.doClose=function(){function close(){debug("writing close packet"),self.write([{type:"close"}])}var self=this;"open"==this.readyState?(debug("transport open - closing"),close()):(debug("transport not open - deferring close"),this.once("open",close))},Polling.prototype.write=function(packets){var self=this;this.writable=!1;var callbackfn=function(){self.writable=!0,self.emit("drain")},self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})},Polling.prototype.uri=function(){var query=this.query||{},schema=this.secure?"https":"http",port="";return!1!==this.timestampRequests&&(query[this.timestampParam]=+new Date+"-"+Transport.timestamps++),this.supportsBinary||query.sid||(query.b64=1),query=parseqs.encode(query),this.port&&("https"==schema&&443!=this.port||"http"==schema&&80!=this.port)&&(port=":"+this.port),query.length&&(query="?"+query),schema+"://"+this.hostname+port+this.path+query}},{"../transport":4,"component-inherit":12,debug:13,"engine.io-parser":16,parseqs:29,xmlhttprequest:10}],9:[function(_dereq_,module,exports){function WS(opts){var forceBase64=opts&&opts.forceBase64;forceBase64&&(this.supportsBinary=!1),Transport.call(this,opts)}var Transport=_dereq_("../transport"),parser=_dereq_("engine.io-parser"),parseqs=_dereq_("parseqs"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:websocket"),WebSocket=_dereq_("ws");module.exports=WS,inherit(WS,Transport),WS.prototype.name="websocket",WS.prototype.supportsBinary=!0,WS.prototype.doOpen=function(){if(this.check()){var uri=this.uri(),protocols=void 0,opts={agent:this.agent};opts.pfx=this.pfx,opts.key=this.key,opts.passphrase=this.passphrase,opts.cert=this.cert,opts.ca=this.ca,opts.ciphers=this.ciphers,opts.rejectUnauthorized=this.rejectUnauthorized,this.ws=new WebSocket(uri,protocols,opts),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()},this.ws.onclose=function(){self.onClose()},this.ws.onmessage=function(ev){self.onData(ev.data)},this.ws.onerror=function(e){self.onError("websocket error",e)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}),WS.prototype.write=function(packets){function ondrain(){self.writable=!0,self.emit("drain")}var self=this;this.writable=!1;for(var i=0,l=packets.length;l>i;i++)parser.encodePacket(packets[i],this.supportsBinary,function(data){try{self.ws.send(data)}catch(e){debug("websocket closed before onclose event")}});setTimeout(ondrain,0)},WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)},WS.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},WS.prototype.uri=function(){var query=this.query||{},schema=this.secure?"wss":"ws",port="";return this.port&&("wss"==schema&&443!=this.port||"ws"==schema&&80!=this.port)&&(port=":"+this.port),this.timestampRequests&&(query[this.timestampParam]=+new Date),this.supportsBinary||(query.b64=1),query=parseqs.encode(query),query.length&&(query="?"+query),schema+"://"+this.hostname+port+this.path+query},WS.prototype.check=function(){return!(!WebSocket||"__initialize"in WebSocket&&this.name===WS.prototype.name)}},{"../transport":4,"component-inherit":12,debug:13,"engine.io-parser":16,parseqs:29,ws:31}],10:[function(_dereq_,module,exports){var hasCORS=_dereq_("has-cors");module.exports=function(opts){var xdomain=opts.xdomain,xscheme=opts.xscheme,enablesXDR=opts.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!xscheme&&enablesXDR)return new XDomainRequest}catch(e){}if(!xdomain)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":25}],11:[function(_dereq_,module,exports){function Emitter(obj){return obj?mixin(obj):void 0}function mixin(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks[event]=this._callbacks[event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){self.off(event,on),fn.apply(this,arguments)}var self=this;return this._callbacks=this._callbacks||{},on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks[event],this;for(var cb,i=0;i<callbacks.length;i++)if(cb=callbacks[i],cb===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;len>i;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks[event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],12:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype,a.prototype=new fn,a.prototype.constructor=a}},{}],13:[function(_dereq_,module,exports){function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function formatArgs(){var args=arguments,useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0,lastC=0;return args[0].replace(/%[a-z%]/g,function(match){"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c),args}function log(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{null==namespaces?localStorage.removeItem("debug"):localStorage.debug=namespaces}catch(e){}}function load(){var r;try{r=localStorage.debug}catch(e){}return r}exports=module.exports=_dereq_("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){return JSON.stringify(v)},exports.enable(load())},{"./debug":14}],14:[function(_dereq_,module,exports){function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}function enabled(){var self=enabled,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,null==self.useColors&&(self.useColors=exports.useColors()),null==self.color&&self.useColors&&(self.color=selectColor());var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&(args=["%o"].concat(args));var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),"function"==typeof exports.formatArgs&&(args=exports.formatArgs.apply(self,args));var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}disabled.enabled=!1,enabled.enabled=!0;var fn=exports.enabled(namespace)?enabled:disabled;return fn.namespace=namespace,fn}function enable(namespaces){exports.save(namespaces);for(var split=(namespaces||"").split(/[\s,]+/),len=split.length,i=0;len>i;i++)split[i]&&(namespaces=split[i].replace(/\*/g,".*?"),"-"===namespaces[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;len>i;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;len>i;i++)if(exports.names[i].test(name))return!0;return!1}function coerce(val){return val instanceof Error?val.stack||val.message:val}exports=module.exports=debug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=_dereq_("ms"),exports.names=[],exports.skips=[],exports.formatters={};
var prevTime,prevColor=0},{ms:15}],15:[function(_dereq_,module,exports){function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]),type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}}function short(ms){return ms>=d?Math.round(ms/d)+"d":ms>=h?Math.round(ms/h)+"h":ms>=m?Math.round(ms/m)+"m":ms>=s?Math.round(ms/s)+"s":ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){return n>ms?void 0:1.5*n>ms?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(val,options){return options=options||{},"string"==typeof val?parse(val):options["long"]?long(val):short(val)}},{}],16:[function(_dereq_,module,exports){(function(global){function encodeBase64Object(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var data=packet.data,contentArray=new Uint8Array(data),resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++)resultBuffer[i+1]=contentArray[i];return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var fr=new FileReader;return fr.onload=function(){packet.data=fr.result,exports.encodePacket(packet,supportsBinary,!0,callback)},fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);if(dontSendBlobs)return encodeBlobAsArrayBuffer(packet,supportsBinary,callback);var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}function map(ary,each,done){for(var result=new Array(ary.length),next=after(ary.length,done),eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg,cb(error,result)})},i=0;i<ary.length;i++)eachWithIndex(i,ary[i],next)}var keys=_dereq_("./keys"),hasBinary=_dereq_("has-binary"),sliceBuffer=_dereq_("arraybuffer.slice"),base64encoder=_dereq_("base64-arraybuffer"),after=_dereq_("after"),utf8=_dereq_("utf8"),isAndroid=navigator.userAgent.match(/Android/i),isPhantomJS=/PhantomJS/i.test(navigator.userAgent),dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},packetslist=keys(packets),err={type:"error",data:"parser error"},Blob=_dereq_("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=!1),"function"==typeof utf8encode&&(callback=utf8encode,utf8encode=null);var data=void 0===packet.data?void 0:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer)return encodeArrayBuffer(packet,supportsBinary,callback);if(Blob&&data instanceof global.Blob)return encodeBlob(packet,supportsBinary,callback);if(data&&data.base64)return encodeBase64Object(packet,callback);var encoded=packets[packet.type];return void 0!==packet.data&&(encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)),callback(""+encoded)},exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof Blob){var fr=new FileReader;return fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)},fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){for(var typed=new Uint8Array(packet.data),basic=new Array(typed.length),i=0;i<typed.length;i++)basic[i]=typed[i];b64data=String.fromCharCode.apply(null,basic)}return message+=global.btoa(b64data),callback(message)},exports.decodePacket=function(data,binaryType,utf8decode){if("string"==typeof data||void 0===data){if("b"==data.charAt(0))return exports.decodeBase64Packet(data.substr(1),binaryType);if(utf8decode)try{data=utf8.decode(data)}catch(e){return err}var type=data.charAt(0);return Number(type)==type&&packetslist[type]?data.length>1?{type:packetslist[type],data:data.substring(1)}:{type:packetslist[type]}:err}var asArray=new Uint8Array(data),type=asArray[0],rest=sliceBuffer(data,1);return Blob&&"blob"===binaryType&&(rest=new Blob([rest])),{type:packetslist[type],data:rest}},exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer)return{type:type,data:{base64:!0,data:msg.substr(1)}};var data=base64encoder.decode(msg.substr(1));return"blob"===binaryType&&Blob&&(data=new Blob([data])),{type:type,data:data}},exports.encodePayload=function(packets,supportsBinary,callback){function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,isBinary?supportsBinary:!1,!0,function(message){doneCallback(null,setLengthHeader(message))})}"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=null);var isBinary=hasBinary(packets);return supportsBinary&&isBinary?Blob&&!dontSendBlobs?exports.encodePayloadAsBlob(packets,callback):exports.encodePayloadAsArrayBuffer(packets,callback):packets.length?void map(packets,encodeOne,function(err,results){return callback(results.join(""))}):callback("0:")},exports.decodePayload=function(data,binaryType,callback){if("string"!=typeof data)return exports.decodePayloadAsBinary(data,binaryType,callback);"function"==typeof binaryType&&(callback=binaryType,binaryType=null);var packet;if(""==data)return callback(err,0,1);for(var n,msg,length="",i=0,l=data.length;l>i;i++){var chr=data.charAt(i);if(":"!=chr)length+=chr;else{if(""==length||length!=(n=Number(length)))return callback(err,0,1);if(msg=data.substr(i+1,n),length!=msg.length)return callback(err,0,1);if(msg.length){if(packet=exports.decodePacket(msg,binaryType,!0),err.type==packet.type&&err.data==packet.data)return callback(err,0,1);var ret=callback(packet,i+n,l);if(!1===ret)return}i+=n,length=""}}return""!=length?callback(err,0,1):void 0},exports.encodePayloadAsArrayBuffer=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,!0,!0,function(data){return doneCallback(null,data)})}return packets.length?void map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;return len="string"==typeof p?p.length:p.byteLength,acc+len.toString().length+len+2},0),resultArray=new Uint8Array(totalLength),bufferIndex=0;return encodedPackets.forEach(function(p){var isString="string"==typeof p,ab=p;if(isString){for(var view=new Uint8Array(p.length),i=0;i<p.length;i++)view[i]=p.charCodeAt(i);ab=view.buffer}isString?resultArray[bufferIndex++]=0:resultArray[bufferIndex++]=1;for(var lenStr=ab.byteLength.toString(),i=0;i<lenStr.length;i++)resultArray[bufferIndex++]=parseInt(lenStr[i]);resultArray[bufferIndex++]=255;for(var view=new Uint8Array(ab),i=0;i<view.length;i++)resultArray[bufferIndex++]=view[i]}),callback(resultArray.buffer)}):callback(new ArrayBuffer(0))},exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,!0,!0,function(encoded){var binaryIdentifier=new Uint8Array(1);if(binaryIdentifier[0]=1,"string"==typeof encoded){for(var view=new Uint8Array(encoded.length),i=0;i<encoded.length;i++)view[i]=encoded.charCodeAt(i);encoded=view.buffer,binaryIdentifier[0]=0}for(var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size,lenStr=len.toString(),lengthAry=new Uint8Array(lenStr.length+1),i=0;i<lenStr.length;i++)lengthAry[i]=parseInt(lenStr[i]);if(lengthAry[lenStr.length]=255,Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})},exports.decodePayloadAsBinary=function(data,binaryType,callback){"function"==typeof binaryType&&(callback=binaryType,binaryType=null);for(var bufferTail=data,buffers=[],numberTooLong=!1;bufferTail.byteLength>0;){for(var tailArray=new Uint8Array(bufferTail),isString=0===tailArray[0],msgLength="",i=1;255!=tailArray[i];i++){if(msgLength.length>310){numberTooLong=!0;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length),msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString)try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++)msg+=String.fromCharCode(typed[i])}buffers.push(msg),bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,!0),i,total)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":17,after:18,"arraybuffer.slice":19,"base64-arraybuffer":20,blob:21,"has-binary":22,utf8:24}],17:[function(_dereq_,module,exports){module.exports=Object.keys||function(obj){var arr=[],has=Object.prototype.hasOwnProperty;for(var i in obj)has.call(obj,i)&&arr.push(i);return arr}},{}],18:[function(_dereq_,module,exports){function after(count,callback,err_cb){function proxy(err,result){if(proxy.count<=0)throw new Error("after called too many times");--proxy.count,err?(bail=!0,callback(err),callback=err_cb):0!==proxy.count||bail||callback(null,result)}var bail=!1;return err_cb=err_cb||noop,proxy.count=count,0===count?callback():proxy}function noop(){}module.exports=after},{}],19:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;if(start=start||0,end=end||bytes,arraybuffer.slice)return arraybuffer.slice(start,end);if(0>start&&(start+=bytes),0>end&&(end+=bytes),end>bytes&&(end=bytes),start>=bytes||start>=end||0===bytes)return new ArrayBuffer(0);for(var abv=new Uint8Array(arraybuffer),result=new Uint8Array(end-start),i=start,ii=0;end>i;i++,ii++)result[ii]=abv[i];return result.buffer}},{}],20:[function(_dereq_,module,exports){!function(chars){"use strict";exports.encode=function(arraybuffer){var i,bytes=new Uint8Array(arraybuffer),len=bytes.length,base64="";for(i=0;len>i;i+=3)base64+=chars[bytes[i]>>2],base64+=chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=chars[63&bytes[i+2]];return len%3===2?base64=base64.substring(0,base64.length-1)+"=":len%3===1&&(base64=base64.substring(0,base64.length-2)+"=="),base64},exports.decode=function(base64){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*base64.length,len=base64.length,p=0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;len>i;i+=4)encoded1=chars.indexOf(base64[i]),encoded2=chars.indexOf(base64[i+1]),encoded3=chars.indexOf(base64[i+2]),encoded4=chars.indexOf(base64[i+3]),bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],21:[function(_dereq_,module,exports){(function(global){function BlobBuilderConstructor(ary,options){options=options||{};for(var bb=new BlobBuilder,i=0;i<ary.length;i++)bb.append(ary[i]);return options.type?bb.getBlob(options.type):bb.getBlob()}var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder,blobSupported=function(){try{var b=new Blob(["hi"]);return 2==b.size}catch(e){return!1}}(),blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;module.exports=function(){return blobSupported?global.Blob:blobBuilderSupported?BlobBuilderConstructor:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(_dereq_,module,exports){(function(global){function hasBinary(data){function _hasBinary(obj){if(!obj)return!1;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File)return!0;if(isArray(obj)){for(var i=0;i<obj.length;i++)if(_hasBinary(obj[i]))return!0}else if(obj&&"object"==typeof obj){obj.toJSON&&(obj=obj.toJSON());for(var key in obj)if(obj.hasOwnProperty(key)&&_hasBinary(obj[key]))return!0}return!1}return _hasBinary(data)}var isArray=_dereq_("isarray");module.exports=hasBinary}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:23}],23:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],24:[function(_dereq_,module,exports){(function(global){!function(root){function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;length>counter;)value=string.charCodeAt(counter++),value>=55296&&56319>=value&&length>counter?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){for(var value,length=array.length,index=-1,output="";++index<length;)value=array[index],value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value);return output}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if(0==(4294967168&codePoint))return stringFromCharCode(codePoint);var symbol="";return 0==(4294965248&codePoint)?symbol=stringFromCharCode(codePoint>>6&31|192):0==(4294901760&codePoint)?(symbol=stringFromCharCode(codePoint>>12&15|224),symbol+=createByte(codePoint,6)):0==(4292870144&codePoint)&&(symbol=stringFromCharCode(codePoint>>18&7|240),symbol+=createByte(codePoint,12),symbol+=createByte(codePoint,6)),symbol+=stringFromCharCode(63&codePoint|128)}function utf8encode(string){for(var codePoint,codePoints=ucs2decode(string),length=codePoints.length,index=-1,byteString="";++index<length;)codePoint=codePoints[index],byteString+=encodeCodePoint(codePoint);return byteString}function readContinuationByte(){if(byteIndex>=byteCount)throw Error("Invalid byte index");var continuationByte=255&byteArray[byteIndex];if(byteIndex++,128==(192&continuationByte))return 63&continuationByte;throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1,byte2,byte3,byte4,codePoint;if(byteIndex>byteCount)throw Error("Invalid byte index");if(byteIndex==byteCount)return!1;if(byte1=255&byteArray[byteIndex],byteIndex++,0==(128&byte1))return byte1;if(192==(224&byte1)){var byte2=readContinuationByte();if(codePoint=(31&byte1)<<6|byte2,codePoint>=128)return codePoint;throw Error("Invalid continuation byte")}if(224==(240&byte1)){if(byte2=readContinuationByte(),byte3=readContinuationByte(),codePoint=(15&byte1)<<12|byte2<<6|byte3,codePoint>=2048)return codePoint;throw Error("Invalid continuation byte")}if(240==(248&byte1)&&(byte2=readContinuationByte(),byte3=readContinuationByte(),byte4=readContinuationByte(),codePoint=(15&byte1)<<18|byte2<<12|byte3<<6|byte4,codePoint>=65536&&1114111>=codePoint))return codePoint;throw Error("Invalid UTF-8 detected")}function utf8decode(byteString){byteArray=ucs2decode(byteString),byteCount=byteArray.length,byteIndex=0;for(var tmp,codePoints=[];(tmp=decodeSymbol())!==!1;)codePoints.push(tmp);return ucs2encode(codePoints)}var freeExports="object"==typeof exports&&exports,freeModule="object"==typeof module&&module&&module.exports==freeExports&&module,freeGlobal="object"==typeof global&&global;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)&&(root=freeGlobal);var byteArray,byteCount,byteIndex,stringFromCharCode=String.fromCharCode,utf8={version:"2.0.0",encode:utf8encode,decode:utf8decode};if(freeExports&&!freeExports.nodeType)if(freeModule)freeModule.exports=utf8;else{var object={},hasOwnProperty=object.hasOwnProperty;for(var key in utf8)hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}else root.utf8=utf8}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(_dereq_,module,exports){var global=_dereq_("global");try{module.exports="XMLHttpRequest"in global&&"withCredentials"in new global.XMLHttpRequest}catch(err){module.exports=!1}},{global:26}],26:[function(_dereq_,module,exports){module.exports=function(){return this}()},{}],27:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],28:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rtrimLeft=/^\s+/,rtrimRight=/\s+$/;module.exports=function(data){return"string"==typeof data&&data?(data=data.replace(rtrimLeft,"").replace(rtrimRight,""),global.JSON&&JSON.parse?JSON.parse(data):rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))?new Function("return "+data)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],29:[function(_dereq_,module,exports){exports.encode=function(obj){var str="";for(var i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str},exports.decode=function(qs){for(var qry={},pairs=qs.split("&"),i=0,l=pairs.length;l>i;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],30:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");-1!=b&&-1!=e&&(str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length));for(var m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return-1!=b&&-1!=e&&(uri.source=src,uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":"),uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":"),uri.ipv6uri=!0),uri}},{}],31:[function(_dereq_,module,exports){function ws(uri,protocols,opts){var instance;return instance=protocols?new WebSocket(uri,protocols):new WebSocket(uri)}var global=function(){return this}(),WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null,WebSocket&&(ws.prototype=WebSocket.prototype)},{}]},{},[1])(1)})}(this.Primus),function(Primus){!function(Primus,undefined){function spark(Spark,Emitter){"use strict";function send(ev,data,fn){return/^(newListener|removeListener)/.test(ev)?this:(this.emitter.send.apply(this.emitter,arguments),this)}var initialise=Spark.prototype.initialise;Spark.prototype.initialise=function(){this.emitter||(this.emitter=new Emitter(this)),this.__initialise||initialise.apply(this,arguments)},Spark.readable?Spark.prototype.send||Spark.readable("send",send):Spark.prototype.send=send}function emitter(){"use strict";function Emitter(conn){return this instanceof Emitter?(this.ids=1,this.acks={},this.conn=conn,void(this.conn&&this.bind())):new Emitter(conn)}var toString=Object.prototype.toString,slice=Array.prototype.slice,isArray=Array.isArray||function(value){return"[object Array]"===toString.call(value)},packets={EVENT:0,ACK:1};return Emitter.prototype.bind=function(){var em=this;return this.conn.on("data",function(packet){em.ondata.call(em,packet)}),this},Emitter.prototype.ondata=function(packet){if(!isArray(packet.data)||packet.id&&"number"!=typeof packet.id)return this;switch(packet.type){case packets.EVENT:this.onevent(packet);break;case packets.ACK:this.onack(packet)}return this},Emitter.prototype.send=function(){var args=slice.call(arguments);return this.conn.write(this.packet(args)),this},Emitter.prototype.packet=function(args){var packet={type:packets.EVENT,data:args};if("function"==typeof args[args.length-1]){var id=this.ids++;this.acks[id]=args.pop(),packet.id=id}return packet},Emitter.prototype.onevent=function(packet){var args=packet.data;return this.conn.reserved(args[0])?this:(packet.id&&args.push(this.ack(packet.id)),this.conn.emit.apply(this.conn,args),this)},Emitter.prototype.ack=function(id){var conn=this.conn,sent=!1;return function(){sent||(sent=!0,conn.write({id:id,type:packets.ACK,data:slice.call(arguments)}))}},Emitter.prototype.onack=function(packet){var ack=this.acks[packet.id];return"function"==typeof ack&&(ack.apply(this,packet.data),delete this.acks[packet.id]),this},Emitter.packets=packets,Emitter}undefined!==Primus&&(Primus.$=Primus.$||{},Primus.$.emitter={},Primus.$.emitter.spark=spark,Primus.$.emitter.emitter=emitter,spark(Primus,emitter()))}(Primus)}(this.Primus);
//# http://slickplan.com/static/cached/src-maps/primus.js.map